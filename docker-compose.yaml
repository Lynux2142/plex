version: "3"

services:
  nordvpn:
    image: ghcr.io/bubuntux/nordvpn
    container_name: nordvpn
    networks:
      - network_nordvpn
    cap_add:
      - NET_ADMIN
      - NET_RAW
    environment:
      - TOKEN=${NORDVPN_TOKEN}
      - CONNECT=Switzerland
      - TECHNOLOGY=NordLynx
      - NETWORK=192.168.0.0/24
      - PORTS=8080;6881;9117
    ports:
      - 8080:8080
      - 6881:6881
      - 6881:6881/udp
      - 9117:9117
      - 8191:8191
    sysctls:
      - net.ipv6.conf.all.disable_ipv6=1
    restart: unless-stopped

  plex:
    image: plexinc/pms-docker:plexpass
    container_name: plex
    network_mode: bridge
    environment:
      - PLEX_UID=297536
      - PLEX_GID=297536
      - TZ=Europe/Paris
    volumes:
      - /var/packages/PlexMediaServer/shares/PlexMediaServer/AppData/tmp:/tmp
      - /var/packages/PlexMediaServer/shares/PlexMediaServer/AppData/tmp:/transcode
      - config_plex:/config/Library/Application Support
      - tv:/tv
      - movies:/movies
    ports:
      - 32400:32400
    devices:
      - /dev/dri:/dev/dri
    restart: unless-stopped

  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
    network_mode: bridge
    environment:
      - PUID=297536
      - PGID=297536
      - TZ=Europe/Paris
    volumes:
      - config_radarr:/config
      - movies:/movies
      - downloads:/downloads
    ports:
      - 7878:7878
    restart: unless-stopped

  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    network_mode: bridge
    environment:
      - PUID=297536
      - PGID=297536
      - TZ=Europe/Paris
    volumes:
      - config_sonarr:/config
      - tv:/tv
      - downloads:/downloads
    ports:
      - 8989:8989
    restart: unless-stopped

  jackett:
    image: lscr.io/linuxserver/jackett:latest
    container_name: jackett
    network_mode: service:nordvpn
    environment:
      - PUID=297536
      - PGID=297536
      - TZ=Europe/Paris
      - AUTO_UPDATE=true
    volumes:
      - config_jackett:/config
      - downloads:/downloads
    restart: unless-stopped
    depends_on:
      - nordvpn

  flaresolverr:
    image: ghcr.io/flaresolverr/flaresolverr:latest
    container_name: flaresolverr
    network_mode: service:nordvpn
    environment:
      - LOG_LEVEL=info
      - LOG_HTML=false
      - CAPTCHA_SOLVER=harvester
      - HARVESTER_ENDPOINT=https://127.0.0.1:5000/token
      - TZ=Europe/Paris
      - PORT=8191
    restart: unless-stopped
    depends_on:
      - nordvpn

  qbittorrent:
    image: lscr.io/linuxserver/qbittorrent:latest
    container_name: qbittorrent
    network_mode: service:nordvpn
    environment:
      - PUID=297536
      - PGID=297536
      - TZ=Europe/Paris
      - WEBUI_PORT=8080
    volumes:
      - config_qbittorrent:/config
      - downloads:/downloads
    restart: unless-stopped
    depends_on:
      - nordvpn

volumes:
  movies:
    driver: local
    driver_opts:
      type: nfs
      device: /volume1/Data/movies
      o: bind

  tv:
    driver: local
    driver_opts:
      type: nfs
      device: /volume1/Data/tv
      o: bind

  downloads:
    driver: local
    driver_opts:
      type: nfs
      device: /volume1/Data/downloads
      o: bind

  config_plex:
    driver: local
    driver_opts:
      type: nfs
      device: /var/packages/PlexMediaServer/shares/PlexMediaServer/AppData/
      o: bind

  config_radarr:
    driver: local
    driver_opts:
      type: nfs
      device: /volume1/Data/config/radarr
      o: bind

  config_sonarr:
    driver: local
    driver_opts:
      type: nfs
      device: /volume1/Data/config/sonarr
      o: bind

  config_jackett:
    driver: local
    driver_opts:
      type: nfs
      device: /volume1/Data/config/jackett
      o: bind

  config_qbittorrent:
    driver: local
    driver_opts:
      type: nfs
      device: /volume1/Data/config/qbittorrent
      o: bind

networks:
  network_nordvpn:
    driver: bridge
